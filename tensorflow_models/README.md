# Tensorflow Training Pipeline
This folder contains files for preparing folder structure, convert Pascal VOC xml annotations to csv files and then convert CSV files into TFRecords.
The Tensorflow Object Detection API is required to train and deploy the Tensorflow models. It can be found at: https://github.com/tensorflow/models/tree/master/research/object_detection.
One also need to provide model checkpoints to the training pipeline these can be found on the Model Zoo: https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md 

# Preparing the folder structure
To convert Pascal VOC XML to CSV and then to TFRecords format the annotation files and images should be placed in three spesific folders; /train_labels, /test_labes for annotations and /images.
These folders can be generated in the current working directory by calling the "prepare_folder_structure.py" file.

# Preparing the Dataset
To use a custom dataset, the only requirement is that the annotation files for the object detector uses the Pascal VOC XML format and that the labels have been placed in train and test folders.
Training and test images can be placed in the same folder. The generated TFRecords are placed in the current working directory.

The xml_to_csv.py have two primary options: -i, --input which is the input path to the folders containing the Pascal VOC XML annotations.
-o, --output which can be used to designate output of the two generated csv files. If no arguments are given the program will look for annotations in the current working directory and files that are generated by the program will be placed in current working directory.

generate_tfrecord.py have four arguments: -i, --input, which takes the path to the image directory. -l, --label which needs the path to the pbtxt label file generated by "xml_to_csv.py".
-c, --csv which takes the path to where the two csv files are stored and -o, --output, which takes a path to where the generated TFRecord files should be stored.  

# Configuring Tensorflow config file
Each model in the Model Zoo, features a pipeline.config file, here the paths to train and test labels, train and test tfrecords, number of classes and number of validation examples must be changed to reflect the number of samples used in the custom dataset.
The steps are usually clearly outlined in the pipeline.config file.

# Training and Deploying a Custom Darknet Detector
To train a custom detector the python program "train_tensorflow_model.py" can be called with arguments, -d, which is the path to the object detection directory where model_main.py is located. -t which specifies the training directory, this is where checkpoints will be saved. 
-c, which takes a path to the pipeline.config for the model that should be trained. -l which logs the training process to stderr.

Training can also be started by using the model_main.py file located in the object detection directory in the Tensorflow Object Detection API.

# Converting to TFLite
Preparing the trained detector to work with TFLite can be done by using the export_tflite_ssd_graph.py in the Tensorflow Object Detection API, and then call tflite_convert on the exported file. 
To run the TFLite file the tflite_runtime can be used to load and run inference on the model.